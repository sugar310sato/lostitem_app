# 拾得物管理システム - インストーラー作成ガイド

## 概要

このドキュメントは、拾得物管理システムのWindowsインストーラーを作成するための完全ガイドです。

## ファイル構成

以下のファイルが作成されています：

### ビルド関連
- **flet_app.spec** - PyInstaller設定ファイル（更新済み）
- **build_installer.bat** - ワンクリックビルドスクリプト
- **installer.iss** - Inno Setupスクリプト

### ドキュメント
- **アプリケーション構成.md** - ファイル構成の詳細
- **インストーラー作成手順.md** - 詳細な手順書
- **インストーラー作成ガイド.md** - このファイル

## クイックスタート

### 必要なソフトウェア

1. **Inno Setup 6**
   - ダウンロード: https://jrsoftware.org/isdl.php
   - インストール: デフォルト設定でインストール

2. **Python 3.11以下**（既にインストール済み）

### インストーラーの作成

#### 方法1: 自動ビルドスクリプト（推奨）

```batch
build_installer.bat
```

このスクリプトが以下を自動実行します：
1. 仮想環境のアクティベート
2. PyInstallerでEXEファイルの再ビルド
3. Inno Setupでインストーラーの作成

#### 方法2: 手動ビルド

**ステップ1: PyInstallerでビルド**

```powershell
# 仮想環境をアクティベート
.\venv\Scripts\activate

# ビルド
pyinstaller flet_app.spec
```

**ステップ2: Inno Setupでビルド**

1. Inno Setupコンパイラーを起動
2. `installer.iss` を開く
3. Build → Compile（Ctrl+F9）

## インストーラーの構成

### インストール先

- **アプリケーションファイル**: `C:\Program Files\拾得物管理システム\`
  - flet_app.exe（メイン実行ファイル）
  - flet_pages\（ページモジュール）
  - *.pt（YOLOモデルファイル）
  - item_classification.json

- **データファイル**: `C:\ProgramData\拾得物管理システム\data\`
  - database\（lostitem.db）
  - images\（画像ファイル）
  - logs\（ログファイル）
  - config\（設定ファイル）

### ショートカット

- デスクトップショートカット（オプション）
- スタートメニューフォルダー: "拾得物管理システム"

## カスタマイズ

### バージョン番号の変更

`installer.iss` の1行目を編集：

```iss
#define MyAppVersion "1.0.0"  ← ここを変更
```

### インストール先の変更

`installer.iss` の `DefaultDirName` を変更：

```iss
DefaultDirName={localappdata}\{#MyAppName}  ; ユーザーAppDataにインストール
```

### アイコンの追加

1. `.ico` 形式のアイコンファイルを作成
2. `installer.iss` に追加：

```iss
Setup]
...
icon=app_icon.ico
```

### 設定ファイルの事前設定

必要に応じて、事前に設定したデータベースファイルを含める：

```iss
Source: "lostitem.db"; DestDir: "{commonappdata}\{#MyAppName}\data\database"; Flags: ignoreversion onlyifdoesntexist
```

## トラブルシューティング

### ビルドエラー

**エラー**: `hiddenimports` が見つからない

**対処**: `flet_app.spec` の `hiddenimports` セクションを確認

### アプリ起動エラー

**エラー**: モジュールが見つからない

**対処**: 
1. `pyinstaller --log-level DEBUG flet_app.spec` でデバッグ
2. 不足しているモジュールを `hiddenimports` に追加

### データパスエラー

**エラー**: データベースが見つからない

**対処**: `data/config/paths.py` の設定を確認

## 配布前のチェックリスト

- [ ] アプリケーションが正常に起動する
- [ ] データベースが作成される
- [ ] 画像が保存される
- [ ] YOLOモデルが読み込まれる
- [ ] アンインストールが正常に動作する
- [ ] バージョン番号が正しい
- [ ] 会社名・アプリケーション名が正しい

## 配布方法

### セルフ実行インストーラー

完成した `拾得物管理システム_Setup_1.0.0.exe` を配布します。
ユーザーはダウンロードして実行するだけでインストールできます。

### デジタル署名（本番環境推奨）

```powershell
# コード署名証明書で署名
signtool sign /f "証明書.pfx" /p "パスワード" "installer\拾得物管理システム_Setup_1.0.0.exe"
```

### 圧縮・アーカイブ

7-Zipなどで圧縮してファイルサイズを削減：

```powershell
7z a -t7z 拾得物管理システム_v1.0.0.7z 拾得物管理システム_Setup_1.0.0.exe
```

## 詳細情報

- アプリケーション構成: `アプリケーション構成.md`
- 手順の詳細: `インストーラー作成手順.md`
- Inno Setup公式ドキュメント: https://jrsoftware.org/ishelp/

## サポート

問題が発生した場合：
1. エラーメッセージを確認
2. ログファイルを確認
3. GitHub イシューを作成（該当する場合）

